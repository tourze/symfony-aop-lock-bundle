# Lockable 注解加锁工作流程

```mermaid
flowchart TD
    A[方法被 #[Lockable] 注解标记] --> B[切面拦截方法调用]
    B --> C[生成锁定 key (支持 Twig 模板)]
    C --> D[通过 LockFactory 创建锁]
    D --> E[在方法执行前尝试获取锁]
    E -->|获取成功| F[执行业务逻辑]
    E -->|获取失败| G[等待或抛出异常]
    F --> H[方法执行结束或抛出异常]
    H --> I[自动释放锁]
```

## 说明

- 只需为方法添加 `#[Lockable]` 注解，切面会自动处理加锁与释放。
- 锁定 key 支持 Twig 模板语法，可灵活拼接参数。
- 锁获取失败时可自定义异常处理。
- 保证无论方法是否异常退出，锁都会被释放，避免死锁。
